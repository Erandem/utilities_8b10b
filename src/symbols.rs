use crate::Disparity;

#[repr(u8)]
pub enum ControlChars {
    K23_7 = 0xF7,
    K27_7 = 0xFB,

    K28_0 = 0x1C,
    K28_1 = 0x3C,
    K28_2 = 0x5C,
    K28_3 = 0x7C,
    K28_4 = 0x9C,
    K28_5 = 0xBC,
    K28_6 = 0xDC,
    K28_7 = 0xFC,

    K29_7 = 0xFD,
    K30_7 = 0xFE,
}

/// Control character lookup table (positive disparity)
/// Format: 10-bit symbol as [4-bit high][6-bit low]
pub const CONTROL_CHARS_POSITIVE: [(u8, u16); 12] = [
    (0x1C, 0b1011_110000), // K28.0
    (0x3C, 0b0110_110000), // K28.1 (or 0b1001_110000 for alt)
    (0x5C, 0b1010_110000), // K28.2
    (0x7C, 0b1100_110000), // K28.3
    (0x9C, 0b1101_110000), // K28.4
    (0xBC, 0b1100_000101), // K28.5 (comma)
    (0xDC, 0b0110_110000), // K28.6 (or 0b1001_110000 for alt)
    (0xFC, 0b1110_110000), // K28.7
    (0xF7, 0b1110_000101), // K23.7
    (0xFB, 0b1110_001001), // K27.7
    (0xFD, 0b1110_010001), // K29.7
    (0xFE, 0b1110_100001), // K30.7
];

/// Table containing [u8->u10] with positive disparity
pub const ENCODE_8B10B_POSITIVE: [u16; 256] = [
    // D.00.0 through D.31.0
    0b0100_011000,
    0b0100_100010,
    0b0100_010010,
    0b0100_110001,
    0b0100_001010,
    0b0100_101001,
    0b0100_011001,
    0b0100_000111,
    0b0100_000110,
    0b0100_100101,
    0b0100_010101,
    0b0100_110100,
    0b0100_001101,
    0b0100_101100,
    0b0100_011100,
    0b0100_101000,
    0b0100_100100,
    0b0100_100011,
    0b0100_010011,
    0b0100_110010,
    0b0100_001011,
    0b0100_101010,
    0b0100_011010,
    0b0100_000101,
    0b0100_001100,
    0b0100_100110,
    0b0100_010110,
    0b0100_001001,
    0b0100_001110,
    0b0100_010001,
    0b0100_100001,
    0b0100_010100,
    // D.00.1 through D.31.1
    0b1001_011000,
    0b1001_100010,
    0b1001_010010,
    0b1001_110001,
    0b1001_001010,
    0b1001_101001,
    0b1001_011001,
    0b1001_000111,
    0b1001_000110,
    0b1001_100101,
    0b1001_010101,
    0b1001_110100,
    0b1001_001101,
    0b1001_101100,
    0b1001_011100,
    0b1001_101000,
    0b1001_100100,
    0b1001_100011,
    0b1001_010011,
    0b1001_110010,
    0b1001_001011,
    0b1001_101010,
    0b1001_011010,
    0b1001_000101,
    0b1001_001100,
    0b1001_100110,
    0b1001_010110,
    0b1001_001001,
    0b1001_001110,
    0b1001_010001,
    0b1001_100001,
    0b1001_010100,
    // D.00.2 through D.31.2
    0b0101_011000,
    0b0101_100010,
    0b0101_010010,
    0b0101_110001,
    0b0101_001010,
    0b0101_101001,
    0b0101_011001,
    0b0101_000111,
    0b0101_000110,
    0b0101_100101,
    0b0101_010101,
    0b0101_110100,
    0b0101_001101,
    0b0101_101100,
    0b0101_011100,
    0b0101_101000,
    0b0101_100100,
    0b0101_100011,
    0b0101_010011,
    0b0101_110010,
    0b0101_001011,
    0b0101_101010,
    0b0101_011010,
    0b0101_000101,
    0b0101_001100,
    0b0101_100110,
    0b0101_010110,
    0b0101_001001,
    0b0101_001110,
    0b0101_010001,
    0b0101_100001,
    0b0101_010100,
    // D.00.3 through D.31.3
    0b0011_011000,
    0b0011_100010,
    0b0011_010010,
    0b0011_110001,
    0b0011_001010,
    0b0011_101001,
    0b0011_011001,
    0b0011_000111,
    0b0011_000110,
    0b0011_100101,
    0b0011_010101,
    0b0011_110100,
    0b0011_001101,
    0b0011_101100,
    0b0011_011100,
    0b0011_101000,
    0b0011_100100,
    0b0011_100011,
    0b0011_010011,
    0b0011_110010,
    0b0011_001011,
    0b0011_101010,
    0b0011_011010,
    0b0011_000101,
    0b0011_001100,
    0b0011_100110,
    0b0011_010110,
    0b0011_001001,
    0b0011_001110,
    0b0011_010001,
    0b0011_100001,
    0b0011_010100,
    // D.00.4 through D.31.4
    0b0010_011000,
    0b0010_100010,
    0b0010_010010,
    0b0010_110001,
    0b0010_001010,
    0b0010_101001,
    0b0010_011001,
    0b0010_000111,
    0b0010_000110,
    0b0010_100101,
    0b0010_010101,
    0b0010_110100,
    0b0010_001101,
    0b0010_101100,
    0b0010_011100,
    0b0010_101000,
    0b0010_100100,
    0b0010_100011,
    0b0010_010011,
    0b0010_110010,
    0b0010_001011,
    0b0010_101010,
    0b0010_011010,
    0b0010_000101,
    0b0010_001100,
    0b0010_100110,
    0b0010_010110,
    0b0010_001001,
    0b0010_001110,
    0b0010_010001,
    0b0010_100001,
    0b0010_010100,
    // D.00.5 through D.31.5
    0b1010_011000,
    0b1010_100010,
    0b1010_010010,
    0b1010_110001,
    0b1010_001010,
    0b1010_101001,
    0b1010_011001,
    0b1010_000111,
    0b1010_000110,
    0b1010_100101,
    0b1010_010101,
    0b1010_110100,
    0b1010_001101,
    0b1010_101100,
    0b1010_011100,
    0b1010_101000,
    0b1010_100100,
    0b1010_100011,
    0b1010_010011,
    0b1010_110010,
    0b1010_001011,
    0b1010_101010,
    0b1010_011010,
    0b1010_000101,
    0b1010_001100,
    0b1010_100110,
    0b1010_010110,
    0b1010_001001,
    0b1010_001110,
    0b1010_010001,
    0b1010_100001,
    0b1010_010100,
    // D.00.6 through D.31.6
    0b0110_011000,
    0b0110_100010,
    0b0110_010010,
    0b0110_110001,
    0b0110_001010,
    0b0110_101001,
    0b0110_011001,
    0b0110_000111,
    0b0110_000110,
    0b0110_100101,
    0b0110_010101,
    0b0110_110100,
    0b0110_001101,
    0b0110_101100,
    0b0110_011100,
    0b0110_101000,
    0b0110_100100,
    0b0110_100011,
    0b0110_010011,
    0b0110_110010,
    0b0110_001011,
    0b0110_101010,
    0b0110_011010,
    0b0110_000101,
    0b0110_001100,
    0b0110_100110,
    0b0110_010110,
    0b0110_001001,
    0b0110_001110,
    0b0110_010001,
    0b0110_100001,
    0b0110_010100,
    // D.00.7 through D.31.7
    0b0001_011000,
    0b0001_100010,
    0b0001_010010,
    0b0001_110001,
    0b0001_001010,
    0b0001_101001,
    0b0001_011001,
    0b0001_000111,
    0b0001_000110,
    0b0001_100101,
    0b0001_010101,
    0b0001_110100,
    0b0001_001101,
    0b0001_101100,
    0b0001_011100,
    0b0001_101000,
    0b0001_100100,
    0b0001_100011,
    0b0001_010011,
    0b0001_110010,
    0b0001_001011,
    0b0001_101010,
    0b0001_011010,
    0b0001_000101,
    0b0001_001100,
    0b0001_100110,
    0b0001_010110,
    0b0001_001001,
    0b0001_001110,
    0b0001_010001,
    0b0001_100001,
    0b0001_010100,
];

pub const ENCODE_8B10B_NEGATIVE: [u16; 256] = {
    // This code inverts the disparity of all symbols before copying them
    let mut output = [0u16; 256];
    let mut i = 0;

    while i < 256 {
        output[i] = Disparity::Negative.with_disparity(ENCODE_8B10B_POSITIVE[i]);
        i += 1;
    }

    output
};

pub const DECODE_8B10B_POSITIVE: [u8; 1024] = generate_decode_table(&ENCODE_8B10B_POSITIVE);

pub const DECODE_8B10B_NEGATIVE: [u8; 1024] = generate_decode_table(&ENCODE_8B10B_NEGATIVE);

const fn generate_decode_table(encode_table: &[u16; 256]) -> [u8; 1024] {
    let mut table = [0xFF; 1024];
    let mut i = 0;

    while i < 256 {
        let symbol = encode_table[i];
        table[symbol as usize] = i as u8;
        i += 1;
    }

    table
}
